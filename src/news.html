<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>新闻资讯</title>
	<link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css">
	<link rel="stylesheet" href="../static/css/bootstrap-datetimepicker.min.css" media="screen">
	<link rel="stylesheet" type="text/css" href="../static/css/diyUpload.css">
	<link rel="stylesheet" type="text/css" href="../static/css/main.css">
</head>
<body>
	<div class="g-mgbg mh1200">
		<div class="g-hd">
			<div class="g-box f-cb">
				<div class="m-logo"><a href=""></a></div>
				<div class="m-login">欢迎，hoo言hoo语<a href="#" class="u-select">个人中心</a>|<a href="#" class="u-exit">退出</a></div>
			</div>
		</div>
		<div class="g-mg-tab">
			<ul class="clearfix">
				<li>
					<img src="../static/images/mg_zl.png">
					<p>赛事总览</p>
				</li>
				<li>
					<img src="../static/images/mg_xs.png">
					<p>参赛选手</p>
				</li>
				<li>
					<img src="../static/images/mg_zx_on.png">
					<p class="on">资讯管理</p>
				</li>
				<li>
					<img src="../static/images/mg_sz.png">
					<p>设置</p>
				</li>
				<li>
					<img src="../static/images/mg_del.png">
					<p>重置/删除</p>
				</li>
			</ul>
		</div>
		<div class="g-mg-reset">
			<div class="g-tp"></div>
			<div class="m-d pb80" style="height:auto;">
				<p class="m-d-tit" style="padding-bottom:17px;">浙江省网娱大师-雪碧真英雄城市争霸赛</p>
				<div class="m-n-list">				
					<label>查找：</label>
					<span class="re">
						<input type="text" class="eventname u-n-slt" placeholder="请输入ID或标题进行查找">
						<button type="button" class="u-n-btn">查找</button>
					</span>
				</div>
				<div class="m-n-list">				
					<label>筛选：</label>
					<select class="w160 mr14">
						<option value="">全部类型</option>
						<option value="">普通资讯</option>
						<option value="">图集资讯</option>
						<option value="">视频资讯</option>
					</select>
					<select class="w160 mr14">
						<option value="">全部状态</option>
						<option value="">生效</option>
						<option value="">失效</option>
						<option value="">删除</option>
					</select>
					<div class="ib re">
					    <input type="text" placeholder="请选择时间" class="w200  form_datetime" readonly>
						<img src="../static/images/datepicker.png" class="ab u-n-date">
					</div>
					&nbsp&nbsp—&nbsp&nbsp
					<div class="ib re">
					    <input type="text" placeholder="请选择时间" class="w200 form_datetime" readonly>
						<img src="../static/images/datepicker.png" class="ab u-n-date">
					</div>
				</div>
				<button type="button" class="u-del-btn u-n-add"><img src="../static/images/plus.png" alt="">添加资讯</button>
				<p class="s-n-th"> 
					<span style="width:100px;">ID</span>
					<span style="width:100px;">图片</span>
					<span style="width:250px;">标题</span>
					<span style="width:100px;">类型</span>
					<span style="width:200px;">创建时间</span>
					<span style="width:100px;">阅读数</span>
					<span style="width:100px;">创建人</span>
					<span style="width:100px;">状态</span>
					<span style="width:100px;">操作</span>
				</p>
				<ul class="s-n-ul clearfix">
					<li>
						<span style="width:100px;"><div class="s-n-div">12</div></span>
						<span style="width:100px;">
							<div class="s-n-img">
								<img src="../static/images/bg.png">
							</div>
						</span>
						<span style="width:250px;">
							<div class="s-n-div">LOL新技能GET-力压群雄必杀技LOL新技能GET-力压群雄必杀技</div>
						</span>
						<span style="width:100px;"><div class="s-n-div">普通资讯</div></span>
						<span style="width:200px;"><div class="s-n-div">2016.06.12 13:00</div></span>
						<span style="width:100px;"><div class="s-n-div">阅读数</div></span>
						<span style="width:100px;"><div class="s-n-div">菊花在骚动</div></span>
						<span style="width:100px;"><div class="s-n-div">状态</div></span>
						<span style="width:100px;">
							<div class="s-n-ort">
								<button type="button" class="u-n-top" topstate="1">已置顶</button>
								<div class="m-n-ort">
									<img src="../static/images/write.png" title="编辑">
									<img src="../static/images/news_del.png" title="删除">
									<img src="../static/images/news_ok.png" title="生效">
								</div>
							</div>
						</span>
					</li>
					<li>
						<span style="width:100px;"><div class="s-n-div">12</div></span>
						<span style="width:100px;">
							<div class="s-n-img">
								<img src="../static/images/bg.png">
							</div>
						</span>
						<span style="width:250px;">
							<div class="s-n-div">LOL新技能GET-力压群雄必杀技LOL新技能GET-力压群雄必杀技</div>
						</span>
						<span style="width:100px;"><div class="s-n-div">普通资讯</div></span>
						<span style="width:200px;"><div class="s-n-div">2016.06.12 13:00</div></span>
						<span style="width:100px;"><div class="s-n-div">阅读数</div></span>
						<span style="width:100px;"><div class="s-n-div">创建人</div></span>
						<span style="width:100px;"><div class="s-n-div">状态</div></span>
						<span style="width:100px;">
							<div class="s-n-ort">
								<button type="button" class="u-n-notop" topstate="0">置顶</button>
								<div class="m-n-ort">
									<img src="../static/images/write.png" title="编辑">
									<img src="../static/images/news_del.png" title="删除">
									<img src="../static/images/news_ok.png" title="生效">
								</div>
							</div>
						</span>
					</li>
					<li>
						<span style="width:100px;"><div class="s-n-div">12</div></span>
						<span style="width:100px;">
							<div class="s-n-img">
								<img src="../static/images/bg.png">
							</div>
						</span>
						<span style="width:250px;">
							<div class="s-n-div">LOL新技能GET-力压群雄必杀技LOL新技能GET-力压群雄必杀技</div>
						</span>
						<span style="width:100px;"><div class="s-n-div">普通资讯</div></span>
						<span style="width:200px;"><div class="s-n-div">2016.06.12 13:00</div></span>
						<span style="width:100px;"><div class="s-n-div">阅读数</div></span>
						<span style="width:100px;"><div class="s-n-div">创建人</div></span>
						<span style="width:100px;"><div class="s-n-div">状态</div></span>
						<span style="width:100px;">
							<div class="s-n-ort">
								<button type="button" class="u-n-notop" topstate="0">置顶</button>
								<div class="m-n-ort">
									<img src="../static/images/write.png">
									<img src="../static/images/news_del.png">
									<img src="../static/images/news_ok.png">
								</div>
							</div>
						</span>
					</li>
					<li>
						<span style="width:100px;"><div class="s-n-div">12</div></span>
						<span style="width:100px;">
							<div class="s-n-img">
								<img src="../static/images/bg.png">
							</div>
						</span>
						<span style="width:250px;">
							<div class="s-n-div">LOL新技能GET-力压群雄必杀技LOL新技能GET-力压群雄必杀技</div>
						</span>
						<span style="width:100px;"><div class="s-n-div">普通资讯</div></span>
						<span style="width:200px;"><div class="s-n-div">2016.06.12 13:00</div></span>
						<span style="width:100px;"><div class="s-n-div">阅读数</div></span>
						<span style="width:100px;"><div class="s-n-div">创建人</div></span>
						<span style="width:100px;"><div class="s-n-div">状态</div></span>
						<span style="width:100px;">
							<div class="s-n-ort">
								<button type="button" class="u-n-notop" topstate="0">置顶</button>
								<div class="m-n-ort">
									<img src="../static/images/write.png">
									<img src="../static/images/news_del.png">
									<img src="../static/images/news_ok.png">
								</div>
							</div>
						</span>
					</li>
					<li>
						<span style="width:100px;"><div class="s-n-div">12</div></span>
						<span style="width:100px;">
							<div class="s-n-img">
								<img src="../static/images/bg.png">
							</div>
						</span>
						<span style="width:250px;">
							<div class="s-n-div">LOL新技能GET-力压群雄必杀技LOL新技能GET-力压群雄必杀技</div>
						</span>
						<span style="width:100px;"><div class="s-n-div">普通资讯</div></span>
						<span style="width:200px;"><div class="s-n-div">2016.06.12 13:00</div></span>
						<span style="width:100px;"><div class="s-n-div">阅读数</div></span>
						<span style="width:100px;"><div class="s-n-div">创建人</div></span>
						<span style="width:100px;"><div class="s-n-div">状态</div></span>
						<span style="width:100px;">
							<div class="s-n-ort">
								<button type="button" class="u-n-notop" topstate="0">置顶</button>
								<div class="m-n-ort">
									<img src="../static/images/write.png">
									<img src="../static/images/news_del.png">
									<img src="../static/images/news_ok.png">
								</div>
							</div>
						</span>
					</li>
				</ul>
				<div class="m-page">
                	<a href="" id="prev"></a>
                	<div class="pagination"><span class="current">2</span>/<span>10</span></div>
                	<a href="" id="next"></a>
                	<input type="text">
                	<a href="" class="u-btn">跳转</a>
                </div>
			</div>
			<div class="g-bt"></div>
		</div>
	</div>
	<div class="m-mask">
		<div class="m-pop">
			<h3>添加资讯</h3>
			<a href="javascript:void(0);"" class="u-btn-close"></a>
			<div class="m-lst">				
				<label for="">标题:</label>
				<input type="text" class="eventname" placeholder="请输入资讯标题">
			</div>
			<div class="m-lst">				
				<label for="">类型:</label>
				<select class="m-n-select">
					<option value="">资讯</option>
					<option value="">图集</option>
					<option value="">视频</option>
				</select>
			</div>
			<div class="m-lst clearfix">				
				<label for="">生效时间:</label>
				<div class="input-append date form_datetime">
				    <input size="16" type="text" value="" placeholder="请选择时间" readonly>
				    <span class="add-on"><i class="icon-th"></i></span>
				</div>
			</div>
			<div class="m-lst">				
				<label for="">创建人:</label>
				<input type="text" class="eventname" placeholder="请输入创建人">
			</div>
			<div class="m-lst clearfix" style="height:74px;">				
				<label for="" style="margin-top:20px;">缩略图:</label>
				<div class="picBox m-n-sltpic">
					<div id="pic" class="l mt10"></div>
				</div>
			</div>
			<div style="display:none;">
				<div class="m-lst">				
					<label for="">资讯来源:</label>
					<input type="text" class="eventname" placeholder="请输入资讯来源">
				</div>
				<div class="m-lst" style="margin: 10px 0;">				
					<label for="">详细内容:</label>
					<textarea name="" id="" cols="50" rows="3"  placeholder="请输入比赛赛制规则，不超过200字"></textarea>
				</div>
			</div>
			<div style="display:none;">
				<div class="m-lst">				
					<label for="">关键字:</label>
					<input type="text" class="eventname" placeholder="请输入关键字">
				</div>
				<div class="m-lst clearfix" style="height:80px;">				
					<label for="" style="margin-top:20px;">首图:</label>
					<div class="picBox m-n-firpic">
						<div id="firstpic" class="l mt10"></div>
					</div>
				</div>
				<div class="m-lst">				
					<label for="">视频地址:</label>
					<input type="text" name="videoUrlUpload" placeholder="点击上传视频" onclick="$('#modal-uploader').modal('show');$fileForm.find('[name=\'file\']').val('').change()" wy-required="视频地址" readonly />
						<a id="a-videoUrl" href="" target="_blank"></a> 
				</div>
			</div>
			<div>
				<div class="m-lst">				
					<label for="">资讯来源:</label>
					<input type="text" class="eventname" placeholder="请输入资讯来源">
				</div>
				<div class="m-lst clearfix">				
					<label for="" class="l">图集:</label>
					<div class="l" style="width: 320px;">
						<div class="tuji clearfix l">
						  	<div class="tujinei">
								<div id="tuji" class="l mt10 m-tuji"></div>
							</div>
							<textarea placeholder="图片描述" class="u-n-ttr"></textarea>
						</div>
						<p class="l col350 csp">+添加一张照片</p>
					</div>
				</div>
			</div>
			<div class="m-lst tc m-n-mbtn" style="padding-left:54px;">
				<button type="button" class="u-del-btn">确定</button>
				<button type="button" class="u-del-btn u-draft-btn">存草稿</button>
			</div>
		</div>
	</div>
</body>
<script src="../static/js/jquery.min.js"></script>
<script type="text/javascript" src="../static/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../static/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="../static/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<script type="text/javascript" src="../static/js/webuploader.html5only.min.js"></script>
<script type="text/javascript" src="../static/js/diyUpload.js"></script>
		<!-- 视频上传 -->
		<div id="modal-uploader" class="modal fade" style="z-index:9999;">
			<div class="modal-dialog" style="width: 800px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span>×</span><span class="sr-only">关闭</span>
						</button>
						<h4 class="modal-title">视频上传</h4>
					</div>
					<div class="modal-body">
						<form id="form-upload" class="form-horizontal" action="">
							<div class="form-group">
								<label class="col-md-2 control-label required">视频</label>
								<div class="col-md-8">
									<div class="input-group">
										<input type="file" class="form-control" name="file" accept="video/*" />
										<span class="input-group-btn">
											<button id="check" type="button" class="btn btn-warning">校验</button>
											<button id="upload" type="button" class="btn btn-info">上传</button>
										</span>
									</div>
								</div>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					</div>
				</div>
			</div>
		</div>
		<!-- 操作中提示 -->
		<div id="modal-operating" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">提示</div>
					<div class="modal-body" style="text-align:center;">
						<div><img src="../static/images/loading.gif" /></div>
						保存中，文件上传可能需要较长时间,请勿中断 ...
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
		var $fileForm = $('#modal-uploader #form-upload');
		
		// 初始化操作按钮
		var checkFile = false;
		function initUploadBtn() {
			var filename = $fileForm.find('[name="file"]').val();
			var $check = $fileForm.find('#check');
			var $upload = $fileForm.find('#upload');
			if(checkFile && checkFile == filename) {// 文件已校验,可进行上传
				$check.hide();
				$upload.show();
			} else {// 未校验或文件变更
				$check.show();
				$upload.hide();
			}
		}
		$fileForm.find('[name="file"]').on('change', function(ev) {
			initUploadBtn();
		});
		$fileForm.find('[name="file"]').change();
		
		// 校验
		$fileForm.find('#check').on('click', function(ev) {
			// 检查表单必填项
			var $file = $fileForm.find('[name="file"]');
			var $prompt = $file.parent();
			var filename = $file.val();
			var fileChecked = true;
			if(filename.length <= 0) {
				$prompt.formErr('请先选择文件');
				fileChecked = false;
			} else {
				$prompt.formCorr();
			}
			
			// 校验文件
			if(fileChecked) {
				var $this = $(this);
				$this.prop('disabled', true);
				
				var infoId = $('#infoId').val();
				$prompt.formErr('文件校验中, 请稍等 ...');
				$.api('${ctx}/upYunFormApi/check', {'filename': filename, 'infoId': infoId}, function(d) {
					var res = d.object;
					// 初始化校验数据
					var action = res.action;
					var signature = res.signature;
					var policy = res.policy;
					var params = res.params;
					
					function hidden(name, value) {
						return '<input type="hidden" name="' + name + '" value="' + value + '" />';
					}
					$fileForm.attr('action', action);
					if(params) {
						for(var k in params) {
							var value = params[k];
							var input = $fileForm.get(0).appendChild(document.createElement('input'));
							var $input = $(input);
							$input.prop('type', 'hidden');
							$input.attr('name', k);
							$input.val(value);
						}
					}
					$fileForm.append(hidden('signature', signature));
					$fileForm.append(hidden('policy', policy));
					
					// 初始化表单操作按钮
					checkFile = res.filename;
					initUploadBtn();
					
					$prompt.formCorr();
				}, false, {
					complete: function() {
						$this.prop('disabled', false);
					}
				});
			}
		});
		
		// 上传
		$fileForm.find('#upload').on('click', function(ev) {
			var $this = $(this);
			$this.prop('disabled', true);
			var $prompt = $fileForm.find('[name="file"]').parent();
			
			$prompt.formErr('上传中,请稍等 ..');
			$('#modal-operating').modal('show');
			$('#modal-uploader').modal('hide');
			$fileForm.ajaxSubmit({
				'url': $fileForm.attr('action'),
				'type': 'post',
				'dataType': 'json',
				'success': function(d) {
					var code = d.code;
					if(code == 200) {
						$form.find('input[name="videoUrlUpload"]').val(d.url).change();
						$prompt.formCorr();
					} else {
						$('#modal-uploader').modal('show');
						$prompt.formErr('操作失败,原因:' + d.message);
					}
					console.log(d);
				},
				complete: function() {
					console.log('完成');
					$('#modal-operating').modal('hide');
				}
			});
		});
		</script>
<script type="text/javascript">
	    $('.form_datetime').datetimepicker({
	        language:  "zh-CN",
	        weekStart: 1,
	        todayBtn:  1,
			autoclose: 1,
			todayHighlight: 1,
			startView: 2,
			forceParse: 0,
	        showMeridian: 1,
	        pickerPosition:'bottom-left'
	    });
		$('.form_date').datetimepicker({
	        language:  "zh-CN",
	        weekStart: 1,
	        todayBtn:  1,
			autoclose: 1,
			todayHighlight: 1,
			startView: 2,
			minView: 2,
			forceParse: 0
	    });
		$('.form_time').datetimepicker({
	        language:  "zh-CN",
	        weekStart: 1,
	        todayBtn:  1,
			autoclose: 1,
			todayHighlight: 1,
			startView: 1,
			minView: 0,
			maxView: 1,
			forceParse: 0
	    });
	    $(document).ready(function(){
	    	$('.s-n-ul li').each(function(index, el) {
	    		var topstate = $(this).find('.s-n-ort button').attr("topstate");
	    		// alert(topstate);
	    		if(topstate==1){
	    			$(this).find('.s-n-ort').css({"display":"table-cell"});
	    			$(this).hover(function() {
	    				$(this).find('.s-n-ort button').addClass('u-n-cctop').text('取消置顶');
	    				$(this).find('.m-n-ort').show();
	    			}, function() {
	    				$(this).find('.s-n-ort button').removeClass('u-n-cctop').text('已置顶');
	    				$(this).find('.m-n-ort').hide();
	    			});
	    		}
	    		else if(topstate==0){
		    		$(this).hover(function() {
		    			$(this).find('.s-n-ort').css({"display":"table-cell"}).find('.m-n-ort').show();
		    		}, function() {
		    			$(this).find('.s-n-ort').css({"display":"none"})
		    		});
	    		}
	    	});
	    	$('.u-n-add').click(function(){
				$('.m-mask').show();
			})
			$('.u-btn-close').click(function(){
				$('.m-mask').hide();
			})
			// 图片上传
			$('#pic, #firstpic,#tuji').each(function(index, el) {
				$(this).diyUpload({
					url:'server/fileupload.php',
					success:function( data ) {
						console.info( data );
					},
					error:function( err ) {
						console.info( err );	
					},
					buttonText : '选择图片',	
					chunked:true,
					// 分片大小
					chunkSize:512 * 1024,
					//最大上传的文件数量, 总文件大小,单个文件大小(单位字节);
					fileNumLimit:1,
					fileSizeLimit:500000 * 1024,
					fileSingleSizeLimit:50000 * 1024,
					accept: {}
				});
			});

			// $('#firstpic').diyUpload({
			// 	url:'server/fileupload.php',
			// 	success:function( data ) {
			// 		console.info( data );
			// 	},
			// 	error:function( err ) {
			// 		console.info( err );	
			// 	},
			// 	buttonText : '选择图片',
			// 	chunked:true,
			// 	// 分片大小
			// 	chunkSize:512 * 1024,
			// 	//最大上传的文件数量, 总文件大小,单个文件大小(单位字节);
			// 	fileNumLimit:1,
			// 	fileSizeLimit:500000 * 1024,
			// 	fileSingleSizeLimit:50000 * 1024,
			// 	accept: {}
			// });
	    })
	</script>
</html>